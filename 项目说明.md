# 打印工具 - 桌面版

## 📖 概述

这是一个基于 Fyne 框架的桌面打印工具，用于生成和打印二维码、条形码标签。

---

## 🎯 快速开始

### 给开发人员 - 如何打包分发

```bash
# 一键打包所有文件
package.bat
```

打包完成后：
1. 找到生成的 `PrintToolRelease` 文件夹
2. 压缩为 zip 文件
3. 发送给使用人员

### 给使用人员 - 如何安装使用

1. **解压文件** - 解压到任意目录（如 D:\PrintTool）
2. **配置路径** - 编辑 `config.toml`，修改 Adobe Reader 路径
3. **启动程序** - 双击 `PrintTool.exe`

---

## 功能特性

### 1. 设备号打印
- 支持单个或成对设备号打印
- 自动生成二维码
- 支持批量输入（逗号分隔）
- 自动检测重复设备号

### 2. 批量打印
- 支持多个设备号一次性打印
- 生成大尺寸二维码
- 适合批量扫描

### 3. 标签打印
- 支持产品信息标签
- 包含产品名称、颜色、日期、数量、重量等信息
- 自动生成二维码和条形码
- 支持自定义箱号

## 编译和运行

### 快速打包分发（推荐）

```powershell
# 一键打包所有文件，生成可分发的完整版本
package.bat
```

打包完成后，会生成 `打印工具_发布版` 文件夹，包含：
- 编译好的 exe 程序
- 配置文件
- 字体文件
- 条码图片
- 必需的目录结构
- 使用说明

直接将整个文件夹压缩后发送给使用人员即可。

### 开发调试

```powershell
# 直接运行（开发模式）
go run main_desktop.go print_functions.go

# 或使用快捷脚本
run.bat
```

### 手动编译

```powershell
# 编译为 exe 文件（带控制台，便于调试）
go build -o print_desktop.exe main_desktop.go print_functions.go

# 编译发布版（无控制台窗口）
go build -ldflags="-H windowsgui" -o print_desktop.exe main_desktop.go print_functions.go
```

## 项目结构

```
项目根目录/
├── config.toml             # 配置文件（方便用户修改）
├── *.txt                   # 文档文件（方便用户查看）
├── *.xlsx                  # Excel模板
├── resources/              # 静态资源目录
│   ├── fonts/             # 字体文件
│   │   ├── PingFang Regular_0.ttf
│   │   └── PingFang Semibold.ttf
│   └── images/            # 静态图片资源
│       ├── 401-69.png    # 条形码图片
│       ├── 501-69.png
│       └── favicon.ico   # 应用图标
├── images/                 # 运行时生成的图片（临时）
├── pdfs/                   # 运行时生成的PDF（临时）
├── main_desktop.go         # 桌面应用主程序
├── print_functions.go      # 打印功能实现
└── build.bat / package.bat # 构建脚本
```

**设计理念**：
- **配置和文档在外层**：方便用户直接访问和修改
- **资源在 resources**：字体和静态图片不需要用户直接操作

## 配置说明

编辑 `config.toml` 文件：

```toml
# Adobe Reader 路径
adobePath = 'D:\Adobe\Reader1\Reader\AcroRd32.exe'

# 打印时间间隔（秒）
printInterval = 5

# 串口名称（可选）
name = 'com11'

# 波特率（可选）
baud = 115200

# 图片临时目录
imageDir = './images'

# PDF 输出目录
pdfDir = './pdfs'
```

## 使用方法

### 设备号打印

1. 点击"设备号打印" Tab
2. 在输入框中输入设备号，多个设备号用逗号分隔
   - 例如: `12345,67890,11111,22222`
3. 点击"开始打印"按钮
4. 查看日志区域的打印状态

### 批量打印

1. 点击"批量打印" Tab
2. 输入需要批量打印的设备号（逗号分隔）
3. 点击"开始打印"按钮
4. 系统会生成一个大的二维码包含所有设备号

### 标签打印

1. 点击"标签打印" Tab
2. 填写以下信息：
   - **产品名称**: 产品的名称
   - **产品颜色**: 产品颜色
   - **生产日期**: 默认为今天，可修改
   - **产品数量**: 数量（单位：PCS）
   - **毛重/净重**: 重量信息（单位：KG）
   - **条码类型**: 默认为 401，可修改为其他型号
   - **箱号**: 包装箱号码（会自动添加到二维码第一行）
   - **设备号**: 灵活输入格式
     - 每行一个设备号（推荐）
     - 或用逗号分隔：`12345,67890`
     - 或用竖线分隔：`12345|67890`
     - 系统会自动将分隔符转换为换行，便于扫描
3. 点击"🏷️ 打印产品标签"按钮

## 日志功能

- 底部的日志区域会实时显示打印状态和进度
- 支持的日志类型：
  - ✓ 成功操作
  - ❌ 错误提示
  - 普通信息
- 点击"清空日志"按钮可以清空日志内容

## 注意事项

1. **Adobe Reader 路径**: 确保 `config.toml` 中的 `adobePath` 指向正确的 Adobe Reader 可执行文件
2. **目录权限**: 确保程序有权限在 `imageDir` 和 `pdfDir` 目录中创建文件
3. **打印间隔**: `printInterval` 控制每次打印之间的等待时间，避免打印队列堵塞
4. **69码图片**: 标签打印需要 `resources/images/401-69.png` 和 `501-69.png` 等条码图片文件
5. **资源目录**: 字体和静态图片在 `resources/` 目录，配置和文档在根目录方便访问

## 文件说明

- `main_desktop.go` - 桌面应用主程序（包含 UI 逻辑）
- `print_functions.go` - 打印功能实现（原 main.go）
- `config.toml` - 配置文件（根目录）
- `*.txt` / `*.xlsx` - 文档和模板文件（根目录）
- `resources/` - 静态资源目录
  - `fonts/` - 中文字体文件
  - `images/` - 静态图片资源（条形码、图标）
- `images/` - 运行时生成的临时图片目录
- `pdfs/` - 运行时生成的 PDF 文件目录

## 原 Web 版本

如需使用原来的 Web 服务版本，请修改 `print_functions.go` 中的 `mainWeb()` 函数为 `main()` 函数并重新编译。

## 常见问题

### Q: 打印没有反应？
A: 检查 Adobe Reader 路径是否正确，查看日志区域的错误信息。

### Q: 找不到 69 码图片？
A: 确保 `401-69.png`、`501-69.png` 等图片文件在 `resources/images/` 目录下。

### Q: 中文显示乱码？
A: 程序会自动查找系统中的中文字体（微软雅黑、黑体等）。

## 技术栈

- **Go 1.19+**
- **Fyne v2.4.5** - 跨平台 GUI 框架
- **gofpdf** - PDF 生成
- **barcode/qrcode** - 二维码和条形码生成
- **toml** - 配置文件解析

## 开发者

如需修改 UI 布局或添加新功能，请编辑 `main_desktop.go` 文件中的相应函数。
